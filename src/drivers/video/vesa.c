#include <drivers/video/vesa.h>
static uint8_t *lfb;
static int scr_w = 800, scr_h = 600, pitch = 2400;
static int cx = 10, cy = 10;
static uint32_t def_col = 0xFFFFFF;
static const uint8_t font[96][8] = {
    {0}, {24, 60, 60, 24, 24, 0, 24, 0}, {34, 34, 34, 0, 0, 0, 0, 0}, {36, 36, 126, 36, 126, 36, 36, 0}, {24, 62, 96, 60, 6, 124, 24, 0}, {98, 100, 8, 16, 38, 70, 0, 0}, {60, 102, 60, 56, 100, 102, 60, 0}, {24, 24, 48, 0, 0, 0, 0, 0}, {12, 24, 48, 48, 48, 24, 12, 0}, {48, 24, 12, 12, 12, 24, 48, 0}, {0, 102, 60, 255, 60, 102, 0, 0}, {0, 24, 24, 126, 24, 24, 0, 0}, {0, 0, 0, 0, 0, 24, 24, 48}, {0, 0, 0, 126, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 24, 24, 0}, {6, 12, 24, 48, 96, 192, 0, 0}, {60, 102, 110, 118, 102, 102, 60, 0}, {24, 56, 24, 24, 24, 24, 126, 0}, {60, 102, 6, 12, 24, 48, 126, 0}, {60, 102, 6, 28, 6, 102, 60, 0}, {6, 14, 30, 102, 127, 6, 6, 0}, {126, 96, 124, 6, 6, 102, 60, 0}, {28, 48, 96, 124, 102, 102, 60, 0}, {126, 6, 12, 24, 48, 48, 48, 0}, {60, 102, 102, 60, 102, 102, 60, 0}, {60, 102, 102, 62, 6, 12, 120, 0}, {0, 24, 24, 0, 24, 24, 0, 0}, {0, 24, 24, 0, 24, 24, 48, 0}, {6, 12, 24, 48, 24, 12, 6, 0}, {0, 0, 126, 0, 126, 0, 0, 0}, {96, 48, 24, 12, 24, 48, 96, 0}, {24, 0, 24, 24, 0, 24, 0, 0}, {60, 102, 110, 110, 110, 96, 62, 0}, {24, 60, 102, 102, 126, 102, 102, 0}, {124, 102, 102, 124, 102, 102, 124, 0}, {60, 102, 96, 96, 96, 102, 60, 0}, {120, 108, 102, 102, 102, 108, 120, 0}, {126, 96, 96, 124, 96, 96, 126, 0}, {126, 96, 96, 124, 96, 96, 96, 0}, {60, 102, 96, 110, 102, 102, 62, 0}, {102, 102, 102, 126, 102, 102, 102, 0}, {60, 24, 24, 24, 24, 24, 60, 0}, {6, 6, 6, 6, 6, 102, 60, 0}, {102, 104, 112, 120, 116, 108, 102, 0}, {96, 96, 96, 96, 96, 96, 126, 0}, {99, 119, 127, 107, 99, 99, 99, 0}, {102, 118, 126, 126, 110, 102, 102, 0}, {60, 102, 102, 102, 102, 102, 60, 0}, {124, 102, 102, 124, 96, 96, 96, 0}, {60, 102, 102, 102, 106, 100, 58, 0}, {124, 102, 102, 124, 108, 102, 102, 0}, {60, 102, 96, 60, 6, 102, 60, 0}, {126, 24, 24, 24, 24, 24, 24, 0}, {102, 102, 102, 102, 102, 102, 60, 0}, {102, 102, 102, 102, 102, 60, 24, 0}, {99, 99, 99, 107, 127, 119, 99, 0}, {102, 102, 60, 24, 60, 102, 102, 0}, {102, 102, 102, 60, 24, 24, 24, 0}, {126, 6, 12, 24, 48, 96, 126, 0}, {60, 48, 48, 48, 48, 48, 60, 0}, {96, 48, 24, 12, 6, 3, 0, 0}, {60, 12, 12, 12, 12, 12, 60, 0}, {24, 60, 102, 0, 0, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 255}, {48, 24, 12, 0, 0, 0, 0, 0}, {0, 0, 60, 6, 62, 102, 62, 0}, {96, 96, 124, 102, 102, 102, 124, 0}, {0, 0, 60, 96, 96, 96, 60, 0}, {6, 6, 62, 102, 102, 102, 62, 0}, {0, 0, 60, 102, 126, 96, 60, 0}, {28, 54, 48, 120, 48, 48, 48, 0}, {0, 0, 58, 102, 102, 62, 6, 56}, {96, 96, 118, 102, 102, 102, 102, 0}, {24, 0, 56, 24, 24, 24, 60, 0}, {12, 0, 12, 12, 12, 12, 12, 108}, {96, 96, 108, 120, 108, 108, 118, 0}, {56, 24, 24, 24, 24, 24, 60, 0}, {0, 0, 106, 127, 127, 107, 0, 0}, {0, 0, 118, 102, 102, 102, 102, 0}, {0, 0, 60, 102, 102, 102, 60, 0}, {0, 0, 118, 102, 102, 124, 96, 96}, {0, 0, 58, 102, 102, 62, 6, 6}, {0, 0, 118, 110, 96, 96, 96, 0}, {0, 0, 62, 96, 60, 6, 124, 0}, {24, 126, 24, 24, 24, 24, 12, 0}, {0, 0, 102, 102, 102, 106, 58, 0}, {0, 0, 102, 102, 102, 60, 24, 0}, {0, 0, 99, 107, 127, 62, 54, 0}, {0, 0, 102, 60, 24, 60, 102, 0}, {0, 0, 102, 102, 102, 62, 12, 112}, {0, 0, 126, 12, 24, 48, 126, 0}, {12, 24, 24, 112, 24, 24, 12, 0}, {24, 24, 24, 24, 24, 24, 24, 24}, {48, 24, 24, 14, 24, 24, 48, 0}, {126, 60, 24, 60, 110, 0, 0, 0}, {0, 0, 0, 0, 0, 0, 0, 0}};
void vesa_init(uint32_t b)
{
    lfb = (uint8_t *)b;
    vesa_clear(0x000088);
}
void vesa_put_pixel(int x, int y, uint32_t c)
{
    if (x >= 0 && x < scr_w && y >= 0 && y < scr_h)
    {
        int o = (y * pitch) + (x * 3);
        lfb[o] = c & 0xFF;
        lfb[o + 1] = (c >> 8) & 0xFF;
        lfb[o + 2] = (c >> 16) & 0xFF;
    }
}
void vesa_clear(uint32_t c)
{
    for (int y = 0; y < scr_h; y++)
        for (int x = 0; x < scr_w; x++)
            vesa_put_pixel(x, y, c);
    cx = 10;
    cy = 10;
}
void vesa_draw_char(char c, int x, int y, uint32_t col)
{
    int i = (int)c - 32;
    if (i < 0 || i > 95)
        i = 31;
    for (int r = 0; r < 8; r++)
        for (int k = 0; k < 8; k++)
            if (font[i][r] & (1 << (7 - k)))
                vesa_put_pixel(x + k, y + r, col);
}
void vesa_print_color(const char *s, uint32_t c)
{
    while (*s)
    {
        if (*s == '\n')
        {
            cx = 10;
            cy += 10;
        }
        else if (*s == '\b')
        {
            if (cx > 10)
            {
                cx -= 8;
                for (int i = 0; i < 8; i++)
                    for (int j = 0; j < 8; j++)
                        vesa_put_pixel(cx + j, cy + i, 0x000088);
            }
        }
        else
        {
            vesa_draw_char(*s, cx, cy, c);
            cx += 8;
        }
        if (cx >= 790)
        {
            cx = 10;
            cy += 10;
        }
        s++;
    }
}
// привет! я вижу ты тут код читаешь
void vesa_print(const char *s) { vesa_print_color(s, def_col); }
